import{r as a,p as r,q as o,w as c,B as s,P as e}from"./vendor.764dd834.js";const i=s("div",{class:"markdown-body"},[s("blockquote",null,[s("p",null,"Custom API Endpoints register new API routes which can be used to infinitely extend the core functionality of the platform.")]),s("h2",{id:"extension-entrypoint"},[e("Extension Entrypoint "),s("a",{class:"header-anchor",href:"#extension-entrypoint"},"#")]),s("p",null,[e("The entrypoint of your endpoint is the "),s("code",null,"index"),e(" file inside the "),s("code",null,"src/"),e(" folder of your extension package. It exports a register function to register one or more custom routes. Each route of your endpoint will be a sub-route of "),s("code",null,"/<extension-name>"),e(".")]),s("div",{class:"tip hint"},[s("div",{class:"hint-title"},"Extension Name"),s("p",null,"The extension name is usually the name of the folder where you put your extension when deploying it.")]),s("p",null,"Example of an entrypoint:"),s("pre",null,[s("code",{class:"language-js"},[s("span",{class:"hljs-keyword"},"export"),e(),s("span",{class:"hljs-keyword"},"default"),e(` (router) => {
	router.get(`),s("span",{class:"hljs-string"},"'/'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Hello, World!'"),e(`));
};
`)])]),s("p",null,"Alternatively, you can export a configuration object to be able to customize the root route:"),s("pre",null,[s("code",{class:"language-js"},[s("span",{class:"hljs-keyword"},"export"),e(),s("span",{class:"hljs-keyword"},"default"),e(` {
	`),s("span",{class:"hljs-attr"},"id"),e(": "),s("span",{class:"hljs-string"},"'greet'"),e(`,
	`),s("span",{class:"hljs-attr"},"register"),e(": "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"router"),e(") =>")]),e(` {
		router.get(`),s("span",{class:"hljs-string"},"'/'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Hello, World!'"),e(`));
		router.get(`),s("span",{class:"hljs-string"},"'/intro'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Nice to meet you.'"),e(`));
		router.get(`),s("span",{class:"hljs-string"},"'/goodbye'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Goodbye!'"),e(`));
	},
};
`)])]),s("p",null,[e("The routes of this endpoint are accessible at "),s("code",null,"/greet"),e(", "),s("code",null,"/greet/intro"),e(" and "),s("code",null,"/greet/goodbye"),e(".")]),s("h4",{id:"available-options"},[e("Available Options "),s("a",{class:"header-anchor",href:"#available-options"},"#")]),s("ul",null,[s("li",null,[s("code",null,"id"),e(" \u2014 The unique key for this endpoint. Each route of your endpoint will be a sub-route of "),s("code",null,"/<id>"),e(".")]),s("li",null,[s("code",null,"register"),e(" \u2014 The endpoint\u2019s register function.")])]),s("h2",{id:"register-function"},[e("Register Function "),s("a",{class:"header-anchor",href:"#register-function"},"#")]),s("p",null,[e("The register function receives the two parameters "),s("code",null,"router"),e(" and "),s("code",null,"context"),e(". "),s("code",null,"router"),e(" is an Express router instance. "),s("code",null,"context"),e(" is an object with the following properties:")]),s("ul",null,[s("li",null,[s("code",null,"services"),e(" \u2014 All API internal services.")]),s("li",null,[s("code",null,"exceptions"),e(" \u2014\xA0API exception objects that can be used to throw \u201Cproper\u201D errors.")]),s("li",null,[s("code",null,"database"),e(" \u2014 Knex instance that is connected to the current database.")]),s("li",null,[s("code",null,"getSchema"),e(" \u2014 Async function that reads the full available schema for use in services")]),s("li",null,[s("code",null,"env"),e(" \u2014\xA0Parsed environment variables.")]),s("li",null,[s("code",null,"logger"),e(" \u2014\xA0"),s("a",{href:"https://github.com/pinojs/pino",target:"_blank",rel:"noopener noreferrer"},"Pino"),e(" instance.")])]),s("h2",{id:"example%3A-recipes"},[e("Example: Recipes "),s("a",{class:"header-anchor",href:"#example%3A-recipes"},"#")]),s("pre",null,[s("code",{class:"language-js"},[s("span",{class:"hljs-keyword"},"export"),e(),s("span",{class:"hljs-keyword"},"default"),e(` (router, { services, exceptions }) => {
	`),s("span",{class:"hljs-keyword"},"const"),e(` { ItemsService } = services;
	`),s("span",{class:"hljs-keyword"},"const"),e(` { ServiceUnavailableException } = exceptions;

	router.get(`),s("span",{class:"hljs-string"},"'/'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res, next"),e(") =>")]),e(` {
		`),s("span",{class:"hljs-keyword"},"const"),e(" recipeService = "),s("span",{class:"hljs-keyword"},"new"),e(" ItemsService("),s("span",{class:"hljs-string"},"'recipes'"),e(", { "),s("span",{class:"hljs-attr"},"schema"),e(": req.schema, "),s("span",{class:"hljs-attr"},"accountability"),e(`: req.accountability });

		recipeService
			.readByQuery({ `),s("span",{class:"hljs-attr"},"sort"),e(": [{ "),s("span",{class:"hljs-attr"},"column"),e(": "),s("span",{class:"hljs-string"},"'name'"),e(", "),s("span",{class:"hljs-attr"},"order"),e(": "),s("span",{class:"hljs-string"},"'asc'"),e(" }], "),s("span",{class:"hljs-attr"},"fields"),e(": ["),s("span",{class:"hljs-string"},"'*'"),e(`] })
			.then(`),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"results"),e(") =>")]),e(` res.json(results))
			.catch(`),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"error"),e(") =>")]),e(` {
				`),s("span",{class:"hljs-keyword"},"return"),e(" next("),s("span",{class:"hljs-keyword"},"new"),e(` ServiceUnavailableException(error.message));
			});
	});
};
`)])])],-1),j={setup(p,{expose:t}){const n={title:"Custom API Endpoints",modularExtension:!0};return t({frontmatter:n}),(u,h)=>{const l=a("DocsWrapper");return r(),o(l,{frontmatter:n},{default:c(()=>[i]),_:1})}}};export{j as default};
